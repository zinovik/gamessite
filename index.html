<!DOCTYPE html>
<html>

    <head>
        <title>Games Server</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
    </head>

    <body>

        <div id="container" class="container-fluid animated">

            <div id="spinnerDiv" style="width: 100%; height: 100%; position: fixed; z-index: 1; background-color: #fff; text-align: center;">Loading...</div>
            <h1>Games Server</h1>

            <div id="usersOnlineDiv"></div>

            <div id="authorizedInputsDiv">
                <div class="form-group">
                    <input type="text" id="usernameInput" class="form-control" placeholder="Username">
                </div>
                <div class="form-group">
                    <input type="password" id="passwordInput" class="form-control" placeholder="Password">
                </div>
                <div class="form-group">
                    <button role='button' id="signInButton" class="btn btn-success">Sign in</button>
                    <button role="button" id="signUpButton" class="btn btn-success">Sign up</button>
                </div>
            </div>
            <div id="logoutDiv" class="form-group">
                <div id="welcomeMessageDiv"></div>
                <button role="button" id="logoutButton" class="btn btn-success">Log out</button>
            </div>    
            <hr>
            <div id="newGameDiv">
                <div>New game: </div>
                <button role="button" id="newNoThanksButton" class="btn btn-success">No, Thanks!</button>
                <button role="button" id="newPerudoButton" class="btn btn-success">Perudo</button>
            </div>

            <div id="allGamesInfoDiv">
                <table id="allGamesInfoTable">
                </table>
            </div>

            <div id="joinedGameDiv">

                <div class="row">
                    <div class="col-md-6 col-sm-12">

                        <img id="gameLogo">
                        <div id="currentGameDiv"></div>
                        <div id="gameStatusDiv"></div>
                        <div id="playerInGameDiv"></div>
                        <div id="watchersInGameDiv"></div>
                        <button role="button" id="leaveGameButton" class="btn btn-success">Leave</button>

                        <div id="notStartedGame">
                            <div id="minPlayersDiv"></div>
                            <div id="maxPlayersDiv"></div>
                            <button role="button" id="readyButton" class="btn btn-success"></button>
                            <button role="button" id="startButton" class="btn btn-success">Start</button>
                        </div>
                        <hr>
                        <div id="startedNotFinishedGame">
                            <div id="nextMovePlayerDiv"></div>

                            <div id="noThanksGameDiv">                                
                                <div id="noThanksCardsLeft"></div>
                                <div id="noThanksCard"></div>
                                <div id="noThanksOtherPlayersInfo"></div>
                                <div id="noThanksCurrentPlayerInfo"></div>
                                <div id="noThanksButtonsDiv">
                                    <button role="button" id="noThanksPayButton" class="btn btn-success">Pay</button>
                                    <button role="button" id="noThanksTakeButton" class="btn btn-success">Take</button>
                                </div>
                            </div>

                            <div id="perudoGameDiv">                
                                <div id="perudoLastPlayerNumber"></div>
                                <div id="perudoLastRoundResults"></div>                          
                                <div id="perudoCurrentRound"></div>
                                <div id="perudoCurrentBet"></div>                             
                                <div id="perudoOtherPlayersInfo"></div>
                                <div id="perudoCurrentPlayerInfo"></div>
                                <div id="perudoButtonsDiv">
                                    <b>Dice number:</b>
                                    <select id="perudoDiceNumber" class="form-control"></select>
                                    <b>Dice figure:</b>
                                    <select id="perudoDiceFigure" class="form-control"></select><br>
                                    <button role="button" id="perudoBetButton" class="btn btn-success">Bet</button>
                                    <button role="button" id="perudoNotBelieveButton" class="btn btn-success">Not Believe</button>
                                </div>
                            </div>

                            <hr>
                        </div>

                        <div id="gameResultsDiv"></div>

                        <button role="button" id="rulesButton" class="btn btn-success">Show rules</button>
                        <div id="rulesDiv" style='display: none;'></div>
                        <br><br>

                    </div>
                    <br>
                    <div class="col-md-6 col-sm-12">
      
                        <div class="form-group">
                            <input type="text" id="messageInput" class="form-control" placeholder="Enter message">
                        </div>
                        <div class="form-group">
                            <button role="button" id="sendButton" class="btn btn-success">Send</button>
                        </div>
            
                        <div id="messagesDiv"></div>

                    </div>
                </div>
            </div>

        </div>



        <script>
            document.addEventListener("DOMContentLoaded", function() {
                spinnerDiv.style.display = 'none';
            });

            var SERVER_URL = 'http://gamesserver.herokuapp.com';
            //var socket = io(SERVER_URL);
            var socket = io();

            socket.on('connect_error', (error) => {
                spinnerDiv.style.display = '';
            });
            socket.on('connect', (error) => {
                spinnerDiv.style.display = 'none';
            });

            // global variables
            var currentUsername;
            var allGamesInfo;
            var openGameNumber;
            var usersOnline = [];
 
            socket.emit('getCurrentUsername');
            socket.emit('getAllGamesInfo');
            socket.emit('getUsersOnline');
            socket.emit('getOpenGameInfo');



            // updates from the server
            socket.on('updateCurrentUsername', function(username) {
                currentUsername = username;
                if (username) {
                    usernameInput.value = '';
                    passwordInput.value = '';
                }
                updateOpenGameNumber();
                updatePage();
                container.classList.remove('fadeIn');
                window.setTimeout(function(){
                    container.classList.add('fadeIn');
                }, 0);
            });

            socket.on('updateAllGamesInfo', function(games) {
                if ((openGameNumber || openGameNumber === 0) && allGamesInfo) {
                    games[openGameNumber] = allGamesInfo[openGameNumber];
                }
                allGamesInfo = games;
                updatePage();
            });

            socket.on('updateOpenGameInfo', function(game) {
                if (!allGamesInfo ) {
                    allGamesInfo = [];
                }
                if ((openGameNumber || openGameNumber === 0)) {
                    allGamesInfo[openGameNumber] = game;
                    updatePage();
                }
            });

            socket.on('updateUsersOnline', function(users) {
                usersOnline = users;
                updateOpenGameNumber();
                updatePage();
            });

            function updateOpenGameNumber() {
                if (!usersOnline) return;
                for (let i = 0; i < usersOnline.length; i++) {
                    if (usersOnline[i].username === currentUsername) {
                        openGameNumber = usersOnline[i].openGameNumber;
                    }
                }
            }



            // buttons click events
            signInButton.onclick = function() {
                socket.emit('authorize', usernameInput.value, passwordInput.value);
            }

            signUpButton.onclick = function() {
                if ((usernameInput.value.length > 2) && (passwordInput.value.length > 2)) {
                    socket.emit('register', usernameInput.value, passwordInput.value);
                }
            }

            logoutButton.onclick = function() {
                socket.emit('logout');
            }

            newNoThanksButton.onclick = function() {
                socket.emit('newgame', 'No, Thanks!');
            }

            newPerudoButton.onclick = function() {
                socket.emit('newgame', 'Perudo');
            }

            allGamesInfoTable.onclick = function(event) {
                if (event.target.tagName !== 'BUTTON') return;
                socket.emit('joingame', event.target.getAttribute('data-game-number'));
                container.classList.remove('fadeIn');
                window.setTimeout(function(){
                    container.classList.add('fadeIn');
                }, 0);
            }

            leaveGameButton.onclick = function() {
                socket.emit('leavegame');
                container.classList.remove('fadeIn');
                window.setTimeout(function(){
                    container.classList.add('fadeIn');
                }, 0);
            }

            readyButton.onclick = function() {
                socket.emit('readytogame');
            }
            
            startButton.onclick = function() {
                socket.emit('startgame');
            }

            rulesButton.onclick = function() {
                rulesDiv.innerHTML = '<br>' + allGamesInfo[openGameNumber].rules;
                rulesButton.innerHTML = (rulesDiv.style.display === 'none') ? 'Hide rules' : 'Show rules';
                rulesDiv.style.display = (rulesDiv.style.display === 'none') ? '' : 'none';
            }

            sendButton.onclick = function() {
                if (messageInput.value.length > 0) {
                    socket.emit('message', messageInput.value);
                    messageInput.value = '';
                }
            }

            messageInput.onkeyup = function (e) {
                if (e.keyCode === 13) {
                    sendButton.dispatchEvent(new Event("click"));
                }
            }

            function updatePage() {
                if (!allGamesInfo) return;

                let authorized = currentUsername;
                let openGame = openGameNumber || openGameNumber === 0;

                changeVisibility(authorized, logoutDiv);
                changeVisibility(!authorized, authorizedInputsDiv);

                changeVisibility(authorized && openGame, joinedGameDiv);
                changeVisibility(!authorized || !openGame, allGamesInfoDiv);
                changeVisibility(authorized && !openGame, newGameDiv);

                welcomeMessageDiv.innerHTML = 'Welcome, ' + currentUsername + '!';
                usersOnlineDiv.innerHTML = '<b>Users online</b> (' + usersOnline.length + '): ';
                for (let i = 0; i < usersOnline.length; i++) {
                    usersOnlineDiv.innerHTML += usersOnline[i].username + ', ';
                }
                usersOnlineDiv.innerHTML = usersOnlineDiv.innerHTML.substring(0, usersOnlineDiv.innerHTML.length - 2);

                currentGameDiv.innerHTML = '<b>Game</b>: #' + openGameNumber;

                if (openGame) {
                    changeVisibility(!allGamesInfo[openGameNumber].gameInfo.started, notStartedGame);
                    changeVisibility((allGamesInfo[openGameNumber].gameInfo.started && !allGamesInfo[openGameNumber].gameInfo.finished), startedNotFinishedGame);
                    changeVisibility(allGamesInfo[openGameNumber].gameInfo.started && allGamesInfo[openGameNumber].nextPlayersNames && (allGamesInfo[openGameNumber].nextPlayersNames.indexOf(currentUsername) >= 0), noThanksButtonsDiv);
                    changeVisibility(allGamesInfo[openGameNumber].gameInfo.started && allGamesInfo[openGameNumber].nextPlayersNames && (allGamesInfo[openGameNumber].nextPlayersNames.indexOf(currentUsername) >= 0), perudoButtonsDiv);
                    changeVisibility(allGamesInfo[openGameNumber].gameInfo.finished, gameResultsDiv)

                    changeVisibility(allGamesInfo[openGameNumber].name === 'No, Thanks!', noThanksGameDiv);
                    changeVisibility(allGamesInfo[openGameNumber].name === 'Perudo', perudoGameDiv);
                    if (allGamesInfo[openGameNumber].name === 'No, Thanks!') {
                        noThanksGame();
                    }
                    if (allGamesInfo[openGameNumber].name === 'Perudo') {
                        perudo();
                    }

                    //gameLogo.src = SERVER_URL + '/images/' + allGamesInfo[openGameNumber].name + '.jpg';
                    gameLogo.src = '/images/' + allGamesInfo[openGameNumber].name + '.jpg';
                    gameLogo.alt = allGamesInfo[openGameNumber].name;

                    minPlayersDiv.innerHTML = 'Minimum players in this game: ' + allGamesInfo[openGameNumber].gameInfo.PLAYERS_MIN;
                    maxPlayersDiv.innerHTML = 'Maximum players in this game: ' + allGamesInfo[openGameNumber].gameInfo.PLAYERS_MAX;

                    gameStatusDiv.innerHTML = '<b>Game status</b>: ' + ((allGamesInfo[openGameNumber].gameInfo.started) ? ((allGamesInfo[openGameNumber].gameInfo.finished) ? 'finished' : 'started') : 'not started');
                    playerInGameDiv.innerHTML = '<b>Players in game</b>:';
                    for (var i = 0; i < allGamesInfo[openGameNumber].players.length; i++) {
                        playerInGameDiv.innerHTML += '<br>&nbsp;&nbsp;&nbsp;' + allGamesInfo[openGameNumber].players[i].username;
                        if (!allGamesInfo[openGameNumber].gameInfo.finished) {
                            if (allGamesInfo[openGameNumber].gameInfo.started) {
                                playerInGameDiv.innerHTML += userInGame(allGamesInfo[openGameNumber].players[i].username, openGameNumber) ? ': in game' : ': not in game';
                            } else {
                                playerInGameDiv.innerHTML += allGamesInfo[openGameNumber].players[i].ready ? ': ready' : ': not ready';
                            }
                        }
                    }

                    if (allGamesInfo[openGameNumber].watchers && allGamesInfo[openGameNumber].watchers.length > 0) {
                        var watchersCount = 0;
                        for (var i = 0; i < allGamesInfo[openGameNumber].watchers.length; i++) {
                            if (userInGame(allGamesInfo[openGameNumber].watchers[i].username, openGameNumber)) watchersCount++;
                        }
                        if (watchersCount) {
                            watchersInGameDiv.innerHTML = '<b>Watchers in game</b>:';
                            for (var i = 0; i < allGamesInfo[openGameNumber].watchers.length; i++) {
                                watchersInGameDiv.innerHTML += '<br>&nbsp;&nbsp;&nbsp;' + allGamesInfo[openGameNumber].watchers[i].username;
                            }
                        } else {
                            watchersInGameDiv.innerHTML = '';
                        }
                    } else {
                        watchersInGameDiv.innerHTML = '';
                    }

                    nextMovePlayerDiv.innerHTML = '<b>Next player</b>: ' + allGamesInfo[openGameNumber].nextPlayersNames;

                    // logNchat
                    if (allGamesInfo[openGameNumber].logNchat) {
                        messagesDiv.innerHTML = '<ul>';
                        for (let i = allGamesInfo[openGameNumber].logNchat.length - 1; i >= 0; i--) {
                            if (allGamesInfo[openGameNumber].logNchat[i].type === 'message') {
                                messagesDiv.innerHTML += '<li><b>' + allGamesInfo[openGameNumber].logNchat[i].username + '</b>: ' + allGamesInfo[openGameNumber].logNchat[i].text + '</li>';
                            } else if (allGamesInfo[openGameNumber].logNchat[i].type === 'move') {
                                messagesDiv.innerHTML += '<li><i>' + allGamesInfo[openGameNumber].logNchat[i].username + ' ' + allGamesInfo[openGameNumber].logNchat[i].text + '</i></li>';
                            } else if (allGamesInfo[openGameNumber].logNchat[i].type === 'event') {
                                messagesDiv.innerHTML += '<li><i>' + allGamesInfo[openGameNumber].logNchat[i].text + '</i></li>';
                            }
                            
                        }
                        messagesDiv.innerHTML += '</ul>';
                    }

                    for (var i = 0; i < allGamesInfo[openGameNumber].players.length; i++) {
                        if (allGamesInfo[openGameNumber].players[i].username === currentUsername) {
                            readyButton.innerHTML = allGamesInfo[openGameNumber].players[i].ready ? 'Not ready' : 'Ready'; 
                        }     
                    }
                }

                makeGameListTable();

            }

            function userInGame(username, gameNumber) {
                for (var i = 0; i < usersOnline.length; i++) {
                    if (usersOnline[i].username === username && usersOnline[i].openGameNumber === gameNumber) {
                        return true;
                    }
                }
                return false;
            }

            function makeGameListTable() {
                if (!allGamesInfo) return;

                allGamesInfoTable.innerHTML = '<th>Game</th><th>Name</th><th>Players</th><th>Status</th><th>Action</th>';
                allGamesInfoTable.style.width = '100%';
                allGamesInfoTable.style.textAlign = 'left';

                let currentGames;
                for (let i = 0; i < usersOnline.length; i++) {
                    if (usersOnline[i].username === currentUsername) {
                        currentGames = usersOnline[i].currentGames;
                    }
                }

                for (let i = 0; i < allGamesInfo.length; i++) {
                    let tr = document.createElement('tr');

                    let td1 = document.createElement('td');
                    td1.innerHTML = '#' + i;
                    tr.appendChild(td1);

                    let td2 = document.createElement('td');
                    let img = document.createElement('img');
                    //img.src = SERVER_URL + '/images/' + allGamesInfo[i].name + '.jpg';
                    img.src = '/images/' + allGamesInfo[i].name + '.jpg';
                    img.alt = allGamesInfo[i].name;
                    td2.appendChild(img);
                    tr.appendChild(td2);

                    let td3 = document.createElement('td');
                    td3.innerHTML = allGamesInfo[i].players.length;
                    tr.appendChild(td3);

                    let td4 = document.createElement('td');
                    td4.innerHTML = (allGamesInfo[i].gameInfo.started) ? ((allGamesInfo[i].gameInfo.finished) ? 'finished' : 'started') : 'not started';
                    tr.appendChild(td4);

                    let td5 = document.createElement('td');
                    let actionButton = document.createElement('button');
                    if (!allGamesInfo[i].gameInfo.finished) {
                        if (currentGames && (currentGames.indexOf("" + i) >= 0)) {
                            actionButton.innerHTML = 'Open';
                        } else if (!allGamesInfo[i].gameInfo.started && (allGamesInfo[i].players.length < allGamesInfo[i].gameInfo.PLAYERS_MAX)) {
                            actionButton.innerHTML = 'Join';
                        } else {
                            actionButton.innerHTML = 'Watch';
                        }
                    } else {
                        actionButton.innerHTML = 'Watch';
                    }
                    actionButton.setAttribute("role", "button");
                    actionButton.setAttribute("class", "btn btn-success");
                    actionButton.setAttribute("data-game-number", i);
                    changeVisibility(currentUsername, actionButton);
                    td5.appendChild(actionButton);
                    tr.appendChild(td5);

                    allGamesInfoTable.insertBefore(tr, allGamesInfoTable.childNodes[1]);
                }
            }

            function changeVisibility(visibleCondition, element) {
                element.style.display = visibleCondition ? '' : 'none';
            }

            function noThanksGame() {
                noThanksPayButton.onclick = function() {
                    socket.emit('move', {takeCard: false});
                };

                noThanksTakeButton.onclick = function() {
                    socket.emit('move', {takeCard: true});
                };

                noThanksCardsLeft.innerHTML = '<b>Cards left</b>: ' + allGamesInfo[openGameNumber].gameInfo.cardsLeft;
                noThanksCard.innerHTML = '<br><b>Current card</b>: <h1><b>' + allGamesInfo[openGameNumber].gameInfo.currentCard + '</b></h1> (' + allGamesInfo[openGameNumber].gameInfo.currentCardCost + ' chips)';

                noThanksOtherPlayersInfo.innerHTML = '';
                noThanksCurrentPlayerInfo.innerHTML = '';

                if (!allGamesInfo[openGameNumber].gameInfo.players) return;

                if (allGamesInfo[openGameNumber].gameInfo.started) {
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.players.length; i++) {
                        if (!allGamesInfo[openGameNumber].players[i]) continue;

                        if (allGamesInfo[openGameNumber].players[i].username === currentUsername) {
                            noThanksCurrentPlayerInfo.innerHTML += '<br>My chips: ' + allGamesInfo[openGameNumber].gameInfo.players[i].chips + '<br>';
                            noThanksCurrentPlayerInfo.innerHTML += 'My cards: ' + JSON.stringify(allGamesInfo[openGameNumber].gameInfo.players[i].cards) + '<br>';
                            noThanksCurrentPlayerInfo.innerHTML += 'My points: ' + allGamesInfo[openGameNumber].gameInfo.players[i].points + '<br><br>';
                        } else {
                            noThanksOtherPlayersInfo.innerHTML += '<br><b>' + allGamesInfo[openGameNumber].players[i].username + '</b>\'s cards: ' + JSON.stringify(allGamesInfo[openGameNumber].gameInfo.players[i].cards);
                        }

                        if (allGamesInfo[openGameNumber].players[i].username === currentUsername) {
                            noThanksPayButton.style.display = (allGamesInfo[openGameNumber].gameInfo.players[i].chips > 0) ? '' : 'none';
                        }

                    }
                }

                if (allGamesInfo[openGameNumber].gameInfo.finished) {
                    gameResultsDiv.innerHTML = '';
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.players.length; i++) {
                        gameResultsDiv.innerHTML += allGamesInfo[openGameNumber].players[i].username + ': ' + allGamesInfo[openGameNumber].gameInfo.players[i].place + ' place (' + allGamesInfo[openGameNumber].gameInfo.players[i].points + ' points, cards: ' + JSON.stringify(allGamesInfo[openGameNumber].gameInfo.players[i].cards) + ', ' + allGamesInfo[openGameNumber].gameInfo.players[i].chips + ' chips)<br>';
                    }
                    gameResultsDiv.innerHTML = gameResultsDiv.innerHTML.substring(0, gameResultsDiv.innerHTML.length - 2) + '<br><br><br>';
                }
            }

            function perudo() {
                perudoBetButton.onclick = function() {
                    socket.emit('move', {number: perudoDiceNumber.value, figure: perudoDiceFigure.value});
                };

                perudoNotBelieveButton.onclick = function() {
                    socket.emit('move', {notBelieve: true});
                };

                perudoDiceNumber.innerHTML = '';
                if (allGamesInfo[openGameNumber].gameInfo.currentDiceFigure != 6 && allGamesInfo[openGameNumber].gameInfo.currentDiceNumber != 0) {
                    var option = document.createElement("option");
                    option.text = allGamesInfo[openGameNumber].gameInfo.currentDiceNumber;
                    perudoDiceNumber.add(option);
                }
                var allDicesCount = 0;
                if (allGamesInfo[openGameNumber].gameInfo.players) {
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.players.length; i++) {
                        allDicesCount += allGamesInfo[openGameNumber].gameInfo.players[i].dicesCount;
                    }
                }
                for (let i = +allGamesInfo[openGameNumber].gameInfo.currentDiceNumber + 1; i <= allDicesCount; i++) {
                    var option = document.createElement("option");
                    option.text = i;
                    perudoDiceNumber.add(option);
                }

                function updatePerudoDiceFigureList() {
                    perudoDiceFigure.innerHTML = '';
                    if (perudoDiceNumber.value > allGamesInfo[openGameNumber].gameInfo.currentDiceNumber) {
                        for (let i = 2; i <= 6; i++) {
                            var option = document.createElement("option");
                            option.text = i;
                            perudoDiceFigure.add(option);
                        }
                    } else {
                        if (allGamesInfo[openGameNumber].gameInfo.currentDiceFigure != 6) {
                        for (let i = +allGamesInfo[openGameNumber].gameInfo.currentDiceFigure + 1; i <= 6; i++) {
                            var option = document.createElement("option");
                            option.text = i;
                            perudoDiceFigure.add(option);
                        }
                        } else {
                            for (let i = 2; i <= 6; i++) {
                                var option = document.createElement("option");
                                option.text = i;
                                perudoDiceFigure.add(option);
                            }
                        }
                    }
                }
                updatePerudoDiceFigureList();
                perudoDiceNumber.onchange = updatePerudoDiceFigureList;

                if (allGamesInfo[openGameNumber].players[allGamesInfo[openGameNumber].gameInfo.lastPlayerNumber]) {
                    perudoLastPlayerNumber.innerHTML = '<b>Last player</b>: ' + allGamesInfo[openGameNumber].players[allGamesInfo[openGameNumber].gameInfo.lastPlayerNumber].username;
                }

                if (allGamesInfo[openGameNumber].gameInfo.lastRoundResults) {
                    perudoLastRoundResults.innerHTML = '<b>Last round results</b>: ';
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.players.length; i++) {
                        if (!allGamesInfo[openGameNumber].players[i]) continue;
                        var playerDices = (allGamesInfo[openGameNumber].gameInfo.lastRoundResults[i]) ? allGamesInfo[openGameNumber].gameInfo.lastRoundResults[i] : '-';
                        perudoLastRoundResults.innerHTML += '<br>&nbsp;&nbsp;&nbsp;<b>' + allGamesInfo[openGameNumber].players[i].username + '</b>\'s dices: ' + playerDices;
                    }
                }

                perudoCurrentRound.innerHTML = '<b>Round</b>: ' + allGamesInfo[openGameNumber].gameInfo.currentRound;
                perudoCurrentBet.innerHTML = '';
                if (allGamesInfo[openGameNumber].gameInfo.currentDiceNumber && allGamesInfo[openGameNumber].gameInfo.currentDiceFigure) {
                    var curBet = '';
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.currentDiceNumber; i++) {
                        curBet += allGamesInfo[openGameNumber].gameInfo.currentDiceFigure + ' ';
                    }
                    perudoCurrentBet.innerHTML = '<br><b>Current Bet</b>: <h1><b>' + curBet + '</b></h1>';
                }

                perudoOtherPlayersInfo.innerHTML = '';
                perudoCurrentPlayerInfo.innerHTML = '';

                if (!allGamesInfo[openGameNumber].gameInfo.players) return;

                if (allGamesInfo[openGameNumber].gameInfo.started) {
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.players.length; i++) {
                        if (!allGamesInfo[openGameNumber].players[i]) continue;

                        if (allGamesInfo[openGameNumber].players[i].username === currentUsername) {
                            perudoCurrentPlayerInfo.innerHTML += '<br>My dices: ' + allGamesInfo[openGameNumber].gameInfo.players[i].dices + '<br><br>';
                        } else {
                            perudoOtherPlayersInfo.innerHTML += '<br><b>' + allGamesInfo[openGameNumber].players[i].username + '</b>\'s dice count: ' + allGamesInfo[openGameNumber].gameInfo.players[i].dicesCount;
                        }
                    }
                }

                if (allGamesInfo[openGameNumber].gameInfo.finished) {
                    gameResultsDiv.innerHTML = '';
                    for (var i = 0; i < allGamesInfo[openGameNumber].gameInfo.players.length; i++) {
                        gameResultsDiv.innerHTML += allGamesInfo[openGameNumber].players[i].username + ': ' + allGamesInfo[openGameNumber].gameInfo.players[i].place + ' place<br>';
                    }
                    gameResultsDiv.innerHTML = gameResultsDiv.innerHTML.substring(0, gameResultsDiv.innerHTML.length - 2) + '<br><br><br>';
                }
            }
        </script>

    </body>

</html>